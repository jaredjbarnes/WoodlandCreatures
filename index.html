<!DOCTYPE html>
<html>
<head>
    <title>Woodand Creatures</title>
    <meta charset="utf-8" />
    <style>
        html, body {
            overflow: hidden;
        }
    </style>
</head>
<body>
    <canvas id="viewport" width="600" height="300" style="width:1200px;height:600px;background-color:#1ebd65"></canvas>
    <script src="lib/weblib/lib/BASE/BASE.js"></script>
    <script>
        BASE.require.loader.setRoot("lib/weblib/lib/BASE/");
        BASE.require.loader.setNamespace("app", "app");
        BASE.require.loader.setNamespace("Matter", "Matter");

        BASE.require([
            "app.Game",
            "app.Entity",
            "app.systems.CameraSystem",
            "app.systems.MovementSystem",
            "app.systems.CollisionSystem",
            "app.systems.RestraintSystem",
            "app.systems.CameraControllerSystem",
            "app.systems.SpriteSystem",
            "app.systems.StateMachineSystem",
            "app.systems.KeyboardInputSystem",
            "app.entities.Map",
            "app.entities.Player",
            "app.entities.Tree",
            "app.Timer",
        ], function () {
            var canvas = document.querySelector("#viewport");

            var Timer = app.Timer;
            var Game = app.Game;
            var Camera = app.systems.Camera;
            var Entity = app.Entity;
            var Map = app.entities.Map;
            var MovementSystem = app.systems.MovementSystem;
            var SpriteSystem = app.systems.SpriteSystem;
            var CollisionSystem = app.systems.CollisionSystem;
            var RestraintSystem = app.systems.RestraintSystem;
            var CameraControllerSystem = app.systems.CameraControllerSystem;
            var CameraSystem = app.systems.CameraSystem;
            var StateMachineSystem = app.systems.StateMachineSystem;
            var KeyboardInputSystem = app.systems.KeyboardInputSystem;
            var Player = app.entities.Player;
            var Tree = app.entities.Tree;

            var cameraSystem = new CameraSystem(canvas);
            cameraSystem.cameraName = "character";

            var collisionSystem = new CollisionSystem();
            var movementSystem = new MovementSystem();
            var restraintSystem = new RestraintSystem();
            var cameraControllerSystem = new CameraControllerSystem();
            var stateMachineSystem = new StateMachineSystem();

            var keyboardInputSystem = new KeyboardInputSystem(document, {
                37: "left",
                38: "up",
                39: "right",
                40: "down"
            });

            var spriteSystem = new SpriteSystem();
            var timer = new Timer();
            var map = new Map();
            var player = new Player();
            var tree;
            var treeTransform;

            for (var x = 0 ; x < 100; x++) {
                tree = new Tree();
                transform = tree.properties["transform"][0];

                transform.x = Math.random() * 2000;
                transform.y = Math.random() * 2000;

                map.appendChild(tree);
            }

            map.appendChild(player);

            var game = new Game(map, timer);

            game.appendSystem(keyboardInputSystem);
            game.appendSystem(stateMachineSystem);
            game.appendSystem(movementSystem);
            game.appendSystem(spriteSystem);
            game.appendSystem(cameraControllerSystem);
            game.appendSystem(restraintSystem);
            game.appendSystem(collisionSystem);
            game.appendSystem(cameraSystem);

            game.play();

            window.game = game;
        });
    </script>
</body>
</html>
